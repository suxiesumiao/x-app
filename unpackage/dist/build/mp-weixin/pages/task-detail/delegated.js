(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/task-detail/delegated"],{"06f7":function(t,e,n){"use strict";n.r(e);var s=n("fed0"),a=n.n(s);for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);e["default"]=a.a},1712:function(t,e,n){"use strict";n.r(e);var s=n("2ceb"),a=n("06f7");for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);n("6a94");var o,u=n("f0c5"),r=Object(u["a"])(a["default"],s["b"],s["c"],!1,null,"3500a508",null,!1,s["a"],o);e["default"]=r.exports},"2ceb":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return s}));var s={uNavbar:function(){return n.e("uview-ui/components/u-navbar/u-navbar").then(n.bind(null,"11b1"))},uSteps:function(){return n.e("uview-ui/components/u-steps/u-steps").then(n.bind(null,"73d2"))},nnkjcDetailGroup:function(){return n.e("components/nnkjc-detail-group/nnkjc-detail-group").then(n.bind(null,"138a"))},nnkjcDetailItem:function(){return n.e("components/nnkjc-detail-item/nnkjc-detail-item").then(n.bind(null,"560a"))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,"5231"))},uEmpty:function(){return n.e("uview-ui/components/u-empty/u-empty").then(n.bind(null,"2385"))},uModal:function(){return n.e("uview-ui/components/u-modal/u-modal").then(n.bind(null,"d215"))},uSelect:function(){return n.e("uview-ui/components/u-select/u-select").then(n.bind(null,"d67a"))},uToast:function(){return n.e("uview-ui/components/u-toast/u-toast").then(n.bind(null,"0f55"))}},a=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.showModal=!0},t.e1=function(e){return t.$u.debounce(t.confirmRefuse,500)})},i=[]},"6a94":function(t,e,n){"use strict";var s=n("7572"),a=n.n(s);a.a},7572:function(t,e,n){},ebd1:function(t,e,n){"use strict";(function(t){n("5d15");s(n("66fd"));var e=s(n("1712"));function s(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},fed0:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={name:"task-detail-delegated",data:function(){return{personIdIndexMap:{},showPerson:!1,showPersonTrans:!1,personDefaultV:[0],personList:[],showBtn1:!1,showBtn2:!1,showBtn3:!1,showBtn4:!1,showBtn5:!1,showModal:!1,loading:!1,loadingRefuse:!1,loadingConfirm:!1,empty:!1,detail:{seqNo:"",createTime:"",updateTime:"",statusText:""},background:{background:"#f2f2f8"},current:1,numList:[{name:"新建"},{name:"委派"},{name:"维修"},{name:"检定"}],searchParams:{id:"",status:"",type:""}}},computed:{PREMISS:function(){return this.$store.state.PREMISS}},onLoad:function(t){this.searchParams.id=t.taskId,this.searchParams.status=t.status,this.searchParams.type=t.type},onReady:function(){this.getDetail()},onShow:function(){this.getPersons()},methods:{getPersons:function(){var t=this;this.$u.post("/sys/staff/getStaffListForWexiu").then((function(e){e.data&&(t.personList=e.data.map((function(e,n){return t.personIdIndexMap[e.id]=n,{value:e.id,label:e.staffName}})))})).catch((function(t){}))},personConfirm:function(e){var n=this,s=t.getStorageSync("user");s&&s.staffId===e[0].value?this.$refs.uToast.show({title:"不能派单给自己",type:"warning"}):(this.personDefaultV=[this.personIdIndexMap[e[0].value]||0],this.$u.post("maint/saveSend",{taskId:this.searchParams.id||this.detail.id,type:this.searchParams.type,maintStaffIds:e[0].value}).then((function(e){200===e.code&&(n.$store.commit("freshTaskFunc",!0),n.$refs.uToast.show({title:e.message,type:"success"}),setTimeout((function(){t.navigateTo({url:"/pages/home/index"},500)})))})).catch((function(t){})).finally((function(t){n.showPerson=!1})))},personConfirmTrans:function(e){var n=this;console.log(e);var s=t.getStorageSync("user");s&&s.staffId===e[0].value?this.$refs.uToast.show({title:"不能转单给自己",type:"warning"}):(this.personDefaultV=[this.personIdIndexMap[e[0].value]||0],this.$u.post("maint/transSend",{taskId:this.searchParams.id||this.detail.id,sendId:this.detail.sendId,maintStaffId:e[0].value}).then((function(e){200===e.code&&(n.$store.commit("freshTaskFunc",!0),n.$refs.uToast.show({title:e.message,type:"success"}),setTimeout((function(){t.navigateTo({url:"/pages/home/index"},500)})))})).catch((function(t){})).finally((function(t){n.showPerson=!1})))},personCancel:function(){this.showPerson=!1,this.showPersonTrans=!1},back:function(){t.navigateBack({delta:1})},confirmReceive:function(){var e=this;this.loadingConfirm=!0,this.$u.post("maint/recSend",{taskId:this.searchParams.id,sendId:this.detail.sendId,type:this.searchParams.type}).then((function(n){200===n.code&&(e.$refs.uToast.show({title:"接单成功",type:"success"}),setTimeout((function(){t.reLaunch({url:"/pages/home/index"})}),500))})).catch((function(t){})).finally((function(t){e.loadingConfirm=!1}))},confirmRefuse:function(){var e=this;this.loadingRefuse||("weixiu"===this.searchParams.type?(this.loadingRefuse=!0,this.$u.post("/maint/refuseSend",{taskId:this.detail.id,sendId:this.detail.sendId,type:this.searchParams.type}).then((function(n){200===n.code&&(e.$store.commit("freshTaskFunc",!0),e.$refs.uToast.show({title:n.message,type:"success"}),setTimeout((function(){t.reLaunch({url:"/pages/home/index"},500)})))})).catch((function(t){})).finally((function(t){e.loadingRefuse=!1}))):this.$refs.uToast.show({title:"仅能拒绝维修工单以及巡查工单",type:"warning"}))},foMaintProcess:function(){var e=this.$u.queryParams({taskId:this.searchParams.id});t.navigateTo({url:"/pages/maint-process/index"+e})},getDetail:function(){var e=this;this.$u.post("/maint/getWeixiuTaskDetail",this.searchParams).then((function(n){if(n.data){var s=t.getStorageSync("user"),a=t.getStorageSync("premissObj");if(e.detail=n.data,e.detail){var i=s&&s.staffId===e.detail.maintStaffId,o="20"==e.searchParams.status,u="30"==e.searchParams.status;e.showBtn1=!!(o&&a&&a[e.PREMISS.reveive]&&i),e.showBtn2=!!(o&&a&&a[e.PREMISS.refuse]&&i),e.showBtn3=!!(o&&a&&a[e.PREMISS.reDelegate]),e.showBtn4=!!(u&&a&&a[e.PREMISS.saveMaintRecord]&&i),e.showBtn5=!!(u&&a&&a[e.PREMISS.trans]&&i);var r=[{"表单状态":e.detail.status,"表单 mstaffId":e.detail.maintStaffId,"用户 staffId":s.staffId,"表单类型":e.detail.type,"修改pm":a[e.PREMISS.modifyreason],"取消pm":a[e.PREMISS.delitem],"委派pm":a[e.PREMISS.delegate],"重新委派pm":a[e.PREMISS.reDelegate],"接单pm":a[e.PREMISS.reveive],"拒单pm":a[e.PREMISS.refuse],"转单pm":a[e.PREMISS.trans],"填写维修记录pm":a[e.PREMISS.saveMaintRecord]}];console.table(r)}}else e.empty=!0})).catch((function(t){}))},reDelegatePerson:function(){this.showPerson=!0},transDelegatePerson:function(){this.showPersonTrans=!0},forMakeMaintRecord:function(){var e=this.$u.queryParams({taskId:this.detail.id,sendId:this.detail.sendId});t.navigateTo({url:"/pages/make-maint-record/index"+e})}}};e.default=n}).call(this,n("543d")["default"])}},[["ebd1","common/runtime","common/vendor"]]]);