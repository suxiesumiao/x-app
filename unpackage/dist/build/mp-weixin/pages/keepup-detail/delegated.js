(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/keepup-detail/delegated"],{"0923":function(e,t,n){"use strict";(function(e){n("5d15");s(n("66fd"));var t=s(n("355f"));function s(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"0fda":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return s}));var s={uNavbar:function(){return n.e("uview-ui/components/u-navbar/u-navbar").then(n.bind(null,"11b1"))},uSteps:function(){return n.e("uview-ui/components/u-steps/u-steps").then(n.bind(null,"73d2"))},nnkjcDetailGroup:function(){return n.e("components/nnkjc-detail-group/nnkjc-detail-group").then(n.bind(null,"138a"))},nnkjcDetailItem:function(){return n.e("components/nnkjc-detail-item/nnkjc-detail-item").then(n.bind(null,"560a"))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,"5231"))},uEmpty:function(){return n.e("uview-ui/components/u-empty/u-empty").then(n.bind(null,"2385"))},uSelect:function(){return n.e("uview-ui/components/u-select/u-select").then(n.bind(null,"d67a"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"2bd4"))},uToast:function(){return n.e("uview-ui/components/u-toast/u-toast").then(n.bind(null,"0f55"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.personList,(function(t,n){var s=e.__get_orig(t),a=e.selectedPerson.indexOf(t.value);return{$orig:s,g0:a}})));e.$mp.data=Object.assign({},{$root:{l0:n}})},i=[]},"2bff":function(e,t,n){"use strict";var s=n("7c52"),a=n.n(s);a.a},"355f":function(e,t,n){"use strict";n.r(t);var s=n("0fda"),a=n("4fed");for(var i in a)"default"!==i&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("2bff");var o,u=n("f0c5"),r=Object(u["a"])(a["default"],s["b"],s["c"],!1,null,"986d97fe",null,!1,s["a"],o);t["default"]=r.exports},"4fed":function(e,t,n){"use strict";n.r(t);var s=n("8cef"),a=n.n(s);for(var i in s)"default"!==i&&function(e){n.d(t,e,(function(){return s[e]}))}(i);t["default"]=a.a},"7c52":function(e,t,n){},"8cef":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=a(n("c8f6"));function a(e){return e&&e.__esModule?e:{default:e}}var i={name:"patrol-detail-delegated",data:function(){return{scrollTop:0,selectedPerson:[],personIdIndexMap:{},showPerson:!1,showPersonTrans:!1,personDefaultV:[0],personList:[],showBtn1:!1,showBtn3:!1,showBtn4:!1,loading:!1,loadingRefuse:!1,loadingConfirm:!1,empty:!1,detail:{seqNo:"",createTime:"",updateTime:"",content:"",statusText:""},background:{background:"#f2f2f8"},current:1,numList:[{name:"新建"},{name:"委派"},{name:"维修"},{name:"检定"}],searchParams:{id:"",status:"",type:""}}},computed:{PREMISS:function(){return this.$store.state.PREMISS},detailContent:function(){return this.detail.content?this.detail.content.split("\n"):[]}},onLoad:function(e){this.searchParams.id=e.taskId,this.searchParams.status=e.status,this.searchParams.type=e.type},onReady:function(){this.getDetail()},onShow:function(){this.getPersons()},methods:{getPersons:function(){var e=this;this.$u.post("/sys/staff/getStaffListForWexiu").then((function(t){t.data&&(e.personList=t.data.map((function(t,n){return e.personIdIndexMap[t.id]=n,{value:t.id,label:t.staffName}})))})).catch((function(e){}))},personConfirm:function(){var t=this;this.selectedPerson.length?this.$u.post("maint/saveSend",{taskId:this.searchParams.id||this.detail.id,type:this.searchParams.type,maintStaffIds:this.selectedPerson.join(",")}).then((function(n){200===n.code&&(t.$store.commit("freshTaskFunc",!0),t.$refs.uToast.show({title:n.message,type:"success"}),setTimeout((function(){e.reLaunch({url:"/pages/home/index"},500)})))})).catch((function(e){})).finally((function(e){t.showPerson=!1})):this.$refs.uToast.show({title:"请选择责任人",type:"warning"})},personCancel:function(){this.showPerson=!1,this.showPersonTrans=!1},back:function(){e.navigateBack({delta:1})},confirmReceive:function(){var t=this;this.loadingConfirm=!0,this.$u.post("maint/recSend",{taskId:this.searchParams.id,sendId:this.detail.sendId,type:this.searchParams.type}).then((function(n){200===n.code&&(t.$refs.uToast.show({title:"接单成功",type:"success"}),setTimeout((function(){e.reLaunch({url:"/pages/home/index"})}),500))})).catch((function(e){})).finally((function(e){t.loadingConfirm=!1}))},foMaintProcess:function(){var t=this.$u.queryParams({taskId:this.searchParams.id});e.navigateTo({url:"/pages/maint-process/index"+t})},getDetail:function(){var t=this;this.$u.post("/maint/getBaoyangTaskDetail",this.searchParams).then((function(n){if(n.data){var a=e.getStorageSync("user"),i=e.getStorageSync("premissObj");if(t.detail=n.data,t.detail){t.detail.cycleTypeText=s.default.CYCLE_MAP[t.detail.cycleType];var o=!1;t.detail.maintStaffIds&&(t.selectedPerson=t.detail.maintStaffIds.split(","),a&&a.staffId&&(o=-1!==t.selectedPerson.indexOf(a.staffId)));var u="20"==t.searchParams.status,r="30"==t.searchParams.status;t.showBtn1=!!(u&&i&&i[t.PREMISS.reveive]&&o),t.showBtn3=!!(u&&i&&i[t.PREMISS.reDelegate]),t.showBtn4=!!(r&&i&&i[t.PREMISS.saveMaintRecord]&&o);var c=[{"表单状态":t.detail.status,"抄表人 id":t.detail.maintStaffIds,"用户 staffId":a.staffId,"表单类型":t.detail.type,"修改pm":i[t.PREMISS.modifyreason],"取消pm":i[t.PREMISS.delitem],"重新委派pm":i[t.PREMISS.reDelegate],"接单pm":i[t.PREMISS.reveive],"填写维修记录pm":i[t.PREMISS.saveMaintRecord]}];console.table(c)}}else t.empty=!0})).catch((function(e){}))},reDelegatePerson:function(){this.showPerson=!0},forMakePatrolRecord:function(){var t=this.$u.queryParams({taskId:this.detail.id,sendId:this.detail.sendId});e.navigateTo({url:"/pages/make-keepup-record/index"+t})},toggleSelect:function(e){var t=this.selectedPerson.indexOf(e);if(-1===t)this.selectedPerson.push(e);else{if(1===this.selectedPerson.length)return void this.$refs.uToast.show({title:"至少选择一个责任人",type:"warning"});this.selectedPerson.splice(t,1)}}}};t.default=i}).call(this,n("543d")["default"])}},[["0923","common/runtime","common/vendor"]]]);