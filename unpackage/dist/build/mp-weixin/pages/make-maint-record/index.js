(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/make-maint-record/index"],{2405:function(t,n,e){"use strict";e.d(n,"b",(function(){return o})),e.d(n,"c",(function(){return i})),e.d(n,"a",(function(){return a}));var a={uNavbar:function(){return e.e("uview-ui/components/u-navbar/u-navbar").then(e.bind(null,"11b1"))},nnkjcDetailGroup:function(){return e.e("components/nnkjc-detail-group/nnkjc-detail-group").then(e.bind(null,"138a"))},nnkjcDetailItem:function(){return e.e("components/nnkjc-detail-item/nnkjc-detail-item").then(e.bind(null,"560a"))},uRadioGroup:function(){return Promise.all([e.e("common/vendor"),e.e("uview-ui/components/u-radio-group/u-radio-group")]).then(e.bind(null,"38e1"))},uRadio:function(){return e.e("uview-ui/components/u-radio/u-radio").then(e.bind(null,"8dc7"))},uRow:function(){return e.e("uview-ui/components/u-row/u-row").then(e.bind(null,"5dc7"))},uCol:function(){return e.e("uview-ui/components/u-col/u-col").then(e.bind(null,"a873"))},uInput:function(){return Promise.all([e.e("common/vendor"),e.e("uview-ui/components/u-input/u-input")]).then(e.bind(null,"8a48"))},uIcon:function(){return e.e("uview-ui/components/u-icon/u-icon").then(e.bind(null,"2bd4"))},commonHeader:function(){return e.e("components/common-header/common-header").then(e.bind(null,"8cb7"))},uUpload:function(){return Promise.all([e.e("common/vendor"),e.e("uview-ui/components/u-upload/u-upload")]).then(e.bind(null,"f0a8"))},uImage:function(){return e.e("uview-ui/components/u-image/u-image").then(e.bind(null,"8342"))},uButton:function(){return e.e("uview-ui/components/u-button/u-button").then(e.bind(null,"5231"))},uToast:function(){return e.e("uview-ui/components/u-toast/u-toast").then(e.bind(null,"0f55"))}},o=function(){var t=this,n=t.$createElement;t._self._c;t._isMounted||(t.e0=function(n){return t.$u.debounce(t.submitForm,500)})},i=[]},3966:function(t,n,e){},"5fd0":function(t,n,e){"use strict";e.r(n);var a=e("2405"),o=e("95d3");for(var i in o)"default"!==i&&function(t){e.d(n,t,(function(){return o[t]}))}(i);e("af5b");var u,s=e("f0c5"),c=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,"7d9a4864",null,!1,a["a"],u);n["default"]=c.exports},"626d":function(t,n,e){"use strict";(function(t){e("5d15");a(e("66fd"));var n=a(e("5fd0"));function a(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},"8f5e":function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=o(e("c8f6"));function o(t){return t&&t.__esModule?t:{default:t}}var i={name:"make-maint-record",data:function(){return{maintRecord:[],maintStaffMap:{},mainted:!1,loading:!1,imageUrl:[],action:a.default.baseUrl+"/maint/uploadFile",header:{Authorization:t.getStorageSync("token")},formData:{fileKey:"maint-record"},fileList:[],valueResult:"",resultList:[{title:"未完成",name:"0"},{title:"维修完成",name:"1"}],resultMap:{0:"未完成",1:"维修完成"},assetAbout:{assetId:"",name:"",code:"",modelName:"",installPos:""},form:{taskId:"",sendId:"",assetFlag:"1",assetId:"",maintType:"in",finishFlag:"0",code:"",content:"",maintPic:""},typeList:[{title:"资产维修",name:"1"},{title:"非资产维修",name:"0"}],typeMap:{0:"非资产维修",1:"资产维修"},maintTypeList:[{title:"自理",name:"in"},{title:"外委",name:"out"}],maintTypeMap:{in:"自理",out:"外委"},background:{background:"#f2f2f8"}}},onLoad:function(t){this.form.taskId=t.taskId,this.form.sendId=t.sendId},onShow:function(){this.getMaintList()},methods:{typeChange:function(t){},dealChange:function(){},resultChange:function(){},back:function(){t.navigateBack({delta:1})},onSuccess:function(t,n,e,a){200===t.code&&t.data&&this.imageUrl.push(t.data)},onRemove:function(t,n,e){this.imageUrl.splice(t,1)},getMaintList:function(){var t=this;this.$u.post("/maint/getMaintList",{taskId:this.form.taskId}).then((function(n){200===n.code&&n.data?(t.mainted=!0,n.data.recordList&&(n.data.recordList.forEach((function(t){t.maintPicReal=t.maintPic.split(",").filter((function(t){return!!t})).map((function(t){return a.default.baseUrl+"/"+t}))})),t.maintRecord=n.data.recordList,t.form.assetFlag=n.data.assetFlag,t.form.maintType=n.data.maintType,t.form.finishFlag=n.data.finishFlag),"1"===n.data.assetFlag&&(t.assetAbout.code=n.data.assetCode,t.assetAbout.name=n.data.assetName,t.assetAbout.modelName=n.data.assetModel,t.assetAbout.installPos=n.data.assetPos)):t.mainted=!1}))},submitForm:function(){var n=this;this.imageUrl.length&&(this.form.maintPic=this.imageUrl.join(","));var e=Object.assign({},this.form);this.loading=!0,this.$u.post("/maint/saveMaintRecord",e).then((function(e){console.log(e),200===e.code&&(n.$refs.uToast.show({title:e.message,type:"success"}),setTimeout((function(){t.reLaunch({url:"/pages/home/index"})}),300))})).catch((function(t){})).finally((function(t){n.loading=!1}))},deleteRecord:function(t){var n=this;this.loading=!0,this.$u.post("/maint/delMaint",{id:t,taskId:this.form.taskId}).then((function(t){200===t.code&&(n.$refs.uToast.show({title:t.message,type:"success"}),n.getMaintList())})).catch((function(t){})).finally((function(t){n.loading=!1}))},doPreviewImage:function(n,e){t.previewImage({urls:n,current:e,success:function(){},fail:function(){t.showToast({title:"预览图片失败",icon:"none"})}})},addNewRecord:function(){var n=this.$u.queryParams({taskId:this.form.taskId,sendId:this.form.sendId});t.navigateTo({url:"./new-maint-record"+n})},scanner:function(){var n=this;t.scanCode({success:function(t){if(console.log("条码类型："+t.scanType),console.log("条码内容："+t.result),t.result){var e=t.result.split("mobile")[1];n.$u.get(e).then((function(t){t.data&&(n.assetAbout.assetId=n.form.assetId=t.data.id,n.assetAbout.code=t.data.code,n.assetAbout.name=t.data.name,n.assetAbout.modelName=t.data.modelName,n.assetAbout.installPos=t.data.installPos)})).catch((function(t){console.log(t)}))}},fail:function(){n.$refs.uToast.show({title:"扫描失败~",type:"warning"})}})}}};n.default=i}).call(this,e("543d")["default"])},"95d3":function(t,n,e){"use strict";e.r(n);var a=e("8f5e"),o=e.n(a);for(var i in a)"default"!==i&&function(t){e.d(n,t,(function(){return a[t]}))}(i);n["default"]=o.a},af5b:function(t,n,e){"use strict";var a=e("3966"),o=e.n(a);o.a}},[["626d","common/runtime","common/vendor"]]]);