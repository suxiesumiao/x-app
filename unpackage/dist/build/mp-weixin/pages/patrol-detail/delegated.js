(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/patrol-detail/delegated"],{"0e36":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={name:"patrol-detail-delegated",data:function(){return{personIdIndexMap:{},showPerson:!1,showPersonTrans:!1,personDefaultV:[0],personList:[],showBtn1:!1,showBtn2:!1,showBtn3:!1,showBtn4:!1,showModal:!1,loading:!1,loadingRefuse:!1,loadingConfirm:!1,empty:!1,detail:{seqNo:"",createTime:"",updateTime:"",statusText:""},background:{background:"#f2f2f8"},current:1,numList:[{name:"新建"},{name:"委派"},{name:"维修"},{name:"检定"}],searchParams:{id:"",status:"",type:""}}},computed:{PREMISS:function(){return this.$store.state.PREMISS}},onLoad:function(t){this.searchParams.id=t.taskId,this.searchParams.status=t.status,this.searchParams.type=t.type},onReady:function(){this.getDetail()},onShow:function(){this.getPersons()},methods:{getPersons:function(){var t=this;this.$u.post("/sys/staff/getStaffListForWexiu").then((function(e){e.data&&(t.personList=e.data.map((function(e,n){return t.personIdIndexMap[e.id]=n,{value:e.id,label:e.staffName}})))})).catch((function(t){}))},personConfirm:function(e){var n=this,a=t.getStorageSync("user");a&&a.staffId===e[0].value?this.$refs.uToast.show({title:"不能派单给自己",type:"warning"}):(this.personDefaultV=[this.personIdIndexMap[e[0].value]||0],this.$u.post("maint/saveSend",{taskId:this.searchParams.id||this.detail.id,type:this.searchParams.type,maintStaffIds:e[0].value}).then((function(e){200===e.code&&(n.$store.commit("freshTaskFunc",!0),n.$refs.uToast.show({title:e.message,type:"success"}),setTimeout((function(){t.reLaunch({url:"/pages/home/index"},500)})))})).catch((function(t){})).finally((function(t){n.showPerson=!1})))},personCancel:function(){this.showPerson=!1,this.showPersonTrans=!1},back:function(){t.navigateBack({delta:1})},confirmReceive:function(){var e=this;this.loadingConfirm=!0,this.$u.post("maint/recSend",{taskId:this.searchParams.id,sendId:this.detail.sendId,type:this.searchParams.type}).then((function(n){200===n.code&&(e.$refs.uToast.show({title:"接单成功",type:"success"}),setTimeout((function(){t.reLaunch({url:"/pages/home/index"})}),500))})).catch((function(t){})).finally((function(t){e.loadingConfirm=!1}))},confirmRefuse:function(){var e=this;this.loadingRefuse||("xuncha"===this.searchParams.type?(this.loadingRefuse=!0,this.$u.post("/maint/refuseSend",{taskId:this.detail.id,sendId:this.detail.sendId,type:this.searchParams.type}).then((function(n){200===n.code&&(e.$store.commit("freshTaskFunc",!0),e.$refs.uToast.show({title:n.message,type:"success"}),setTimeout((function(){t.reLaunch({url:"/pages/home/index"},500)})))})).catch((function(t){})).finally((function(t){e.loadingRefuse=!1}))):this.$refs.uToast.show({title:"仅能拒绝维修工单以及巡查工单",type:"warning"}))},foMaintProcess:function(){var e=this.$u.queryParams({taskId:this.searchParams.id});t.navigateTo({url:"/pages/maint-process/index"+e})},getDetail:function(){var e=this;this.$u.post("/maint/getPatrolDetail",this.searchParams).then((function(n){if(n.data){var a=t.getStorageSync("user"),s=t.getStorageSync("premissObj");if(e.detail=n.data,e.detail){var i=a&&a.staffId===e.detail.patrolStaffId,o="20"==e.searchParams.status,u="30"==e.searchParams.status;e.showBtn1=!!(o&&s&&s[e.PREMISS.reveive]&&i),e.showBtn2=!!(o&&s&&s[e.PREMISS.refuse]&&i),e.showBtn3=!!(o&&s&&s[e.PREMISS.reDelegate]),e.showBtn4=!!(u&&s&&s[e.PREMISS.saveMaintRecord]&&i);var r=[{"表单状态":e.detail.status,"抄表人 id":e.detail.patrolStaffId,"用户 staffId":a.staffId,"表单类型":e.detail.type,"修改pm":s[e.PREMISS.modifyreason],"取消pm":s[e.PREMISS.delitem],"委派pm":s[e.PREMISS.delegate],"重新委派pm":s[e.PREMISS.reDelegate],"接单pm":s[e.PREMISS.reveive],"拒单pm":s[e.PREMISS.refuse],"转单pm":s[e.PREMISS.trans],"填写维修记录pm":s[e.PREMISS.saveMaintRecord]}];console.table(r)}}else e.empty=!0})).catch((function(t){}))},reDelegatePerson:function(){this.showPerson=!0},forMakeMaintRecord:function(){var e=this.$u.queryParams({taskId:this.detail.id,sendId:this.detail.sendId});t.navigateTo({url:"/pages/make-patrol-record/index"+e})}}};e.default=n}).call(this,n("543d")["default"])},1864:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return a}));var a={uNavbar:function(){return n.e("uview-ui/components/u-navbar/u-navbar").then(n.bind(null,"11b1"))},uSteps:function(){return n.e("uview-ui/components/u-steps/u-steps").then(n.bind(null,"73d2"))},nnkjcDetailGroup:function(){return n.e("components/nnkjc-detail-group/nnkjc-detail-group").then(n.bind(null,"138a"))},nnkjcDetailItem:function(){return n.e("components/nnkjc-detail-item/nnkjc-detail-item").then(n.bind(null,"560a"))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,"5231"))},uEmpty:function(){return n.e("uview-ui/components/u-empty/u-empty").then(n.bind(null,"2385"))},uModal:function(){return n.e("uview-ui/components/u-modal/u-modal").then(n.bind(null,"d215"))},uSelect:function(){return n.e("uview-ui/components/u-select/u-select").then(n.bind(null,"d67a"))},uToast:function(){return n.e("uview-ui/components/u-toast/u-toast").then(n.bind(null,"0f55"))}},s=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.showModal=!0},t.e1=function(e){return t.$u.debounce(t.confirmRefuse,500)})},i=[]},3995:function(t,e,n){"use strict";n.r(e);var a=n("1864"),s=n("db5e");for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);n("43cd");var o,u=n("f0c5"),r=Object(u["a"])(s["default"],a["b"],a["c"],!1,null,"3e94211e",null,!1,a["a"],o);e["default"]=r.exports},"43cd":function(t,e,n){"use strict";var a=n("cad7"),s=n.n(a);s.a},"4e38":function(t,e,n){"use strict";(function(t){n("5d15");a(n("66fd"));var e=a(n("3995"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},cad7:function(t,e,n){},db5e:function(t,e,n){"use strict";n.r(e);var a=n("0e36"),s=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=s.a}},[["4e38","common/runtime","common/vendor"]]]);